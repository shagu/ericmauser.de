<!doctype html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="description" content="just some random notes" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300&display=swap" rel="stylesheet" />
  <link href="../../../../style.css" rel="stylesheet" />
  <title>ericmauser - just some random notes</title>
</head>

<body>
  <div class="sidebar">
    <div class="viewport">
      <div class="topbar">
        <a class="title" href="../../../../">ericmauser</a>
        <span class="description">just some random notes</span>
      </div>
      <div class="navigation"><a href="../../../../">welcome!</a> » <a href="../../../">Projects</a> » <a href="../../">wow-addons</a> » <a href="../">pfQuest</a> » <span>toolbox</span></div>
    </div>
  </div>

  <div class="viewport mainview">
    <div class="directories">
      <a class="back sidelink" href="../">« Back</a><a class="sidelink" href="maps/">maps</a><a class="sidelink" href="pngLua/">pngLua</a>
    </div>
    <div class="page">
      <div class="content"><div id="README.md" class="text">
<h1>pfQuest-toolbox</h1>

<h2>Setup Dependencies</h2>
<h3>Archlinux</h3>

<pre><code># pacman -S mariadb mariadb-clients luarocks
# mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql
# systemctl start mariadb
# luarocks install luasql-mysql MYSQL_INCDIR=/usr/include/mysql
</code></pre>

<h2>Prepare Databases</h2>
<p>The pfQuest extractor supports VMaNGOS and CMaNGOS databases. By default, VMaNGOS is used vanilla and CMaNGOS is used for TBC. For CMaNGOS translations, the Mangos-Extras project is used.</p>

<h3>Create Users And Permissions</h3>

<pre><code># mysql
DROP DATABASE IF EXISTS `pfquest`;
DROP DATABASE IF EXISTS `vmangos`;
DROP DATABASE IF EXISTS `cmangos-tbc`;

CREATE USER 'mangos'@'localhost' IDENTIFIED BY 'mangos';

CREATE DATABASE `pfquest` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, ALTER, LOCK TABLES, CREATE TEMPORARY TABLES, EXECUTE, ALTER ROUTINE, CREATE ROUTINE ON `pfquest`.* TO 'mangos'@'localhost';

CREATE DATABASE `vmangos` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, ALTER, LOCK TABLES, CREATE TEMPORARY TABLES, EXECUTE, ALTER ROUTINE, CREATE ROUTINE ON `vmangos`.* TO 'mangos'@'localhost';

CREATE DATABASE `cmangos-tbc` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, ALTER, LOCK TABLES, CREATE TEMPORARY TABLES, EXECUTE, ALTER ROUTINE, CREATE ROUTINE ON `cmangos-tbc`.* TO 'mangos'@'localhost';
</code></pre>

<h3>Import Client Data</h3>

<p>Import the game client data SQL files:</p>

<pre><code>mysql -u mangos -p"mangos" pfquest &lt; client-data.sql
</code></pre>


<h3>Vanilla (VMaNGOS)</h3>

<p>Manually download the latest <a href="https://github.com/brotalnia/database">VMaNGOS Database</a> and unzip it.</p>

<pre><code>mysql -u mangos -p"mangos" vmangos &lt; world_*.sql
</code></pre>

<p>Clone the VMaNGOS core repository to obtain all SQL updates.</p>

<pre><code>git clone https://github.com/vmangos/core.git
cd core/sql/migrations
for file in *_world.sql; do mysql -u mangos -p"mangos" vmangos &lt; $file; done
cd -
</code></pre>

<h3>The Burning Crusade (CMaNGOS)</h3>

<p>Clone the latest CMaNGOS TBC database and the translations of the Mangos-Extras project:</p>

<pre><code>git clone https://github.com/cmangos/mangos-tbc.git
git clone https://github.com/cmangos/tbc-db.git
git clone https://github.com/MangosExtras/MangosOne_Localised.git
cd MangosOne_Localised &amp;&amp; git checkout ae4f4e102f747e36b4064afe8166d89586b981b6 &amp;&amp; cd ..

mysql -u mangos -p"mangos" cmangos-tbc &lt; mangos-tbc/sql/base/mangos.sql
mysql -u mangos -p"mangos" cmangos-tbc &lt; tbc-db/Full_DB/*.sql
for file in tbc-db/Updates/*.sql; do mysql -u mangos -p"mangos" cmangos-tbc &lt; $file; done
mysql -u mangos -p"mangos" cmangos-tbc &lt; mangos-tbc/sql/base/dbc/original_data/Spell.sql
mysql -u mangos -p"mangos" cmangos-tbc &lt; mangos-tbc/sql/base/dbc/cmangos_fixes/Spell.sql
for file in mangos-tbc/sql/updates/mangos/*.sql; do mysql -u mangos -p"mangos" cmangos-tbc &lt; $file; done
mysql -u mangos -p"mangos" cmangos-tbc &lt; tbc-db/ACID/acid_tbc.sql
sed -i "/locales_command/d" MangosOne_Localised/1_LocaleTablePrepare.sql
mysql -u mangos -p"mangos" cmangos-tbc &lt; MangosOne_Localised/1_LocaleTablePrepare.sql
for file in MangosOne_Localised/1_LocaleTablePrepare.sql MangosOne_Localised/Translations/*/*.sql; do mysql -u mangos -p"mangos" cmangos-tbc &lt; $file; done
</code></pre>

<h2>Run the Extractor</h2>

<p>Start the database extractor</p>

<pre><code>$ make
</code></pre>

<h2>Optional: Build Client-Data</h2>
<h3>Copy CSVs to DBC/</h3>
<p>You additionally need to extract the <code>dbc</code> files from your gameclients.
Those can be obtained via the <code>ad</code> tool within the CMaNGOS tools.
The DBC files then need to be converted into <code>.csv</code> and placed as followed:</p>

<pre><code>$ ls -1 DBC/
deDE  enUS  esES  frFR  koKR  ruRU  zhCN

$ ls -1 DBC/deDE
AreaTable.dbc.csv
SkillLine.dbc.csv
WorldMapArea.dbc.csv
</code></pre>

<h3>Required DBCs</h3>
<h4>WorldMapArea.dbc [enUS]</h4>
<p>Required to obtain the map-sizes which are used for
  1. calculating the minimap offset
  2. calculating the objects possible maps during extraction</p>

<h4>Lock.dbc [enUS]</h4>
<p>Used to get a list of all skill requirements which are used during the
meta-list extraction</p>

<h4>AreaTable.dbc [all]</h4>
<p>The <code>AreaTable.dbc</code> is used to build the zones table. The zone table is required
to tell the gameclient which map should be shown when searching for an object.
It's basically a map-id to mape-name translation table.</p>

<h4>SkillLine.dbc [all]</h4>
<p>The <code>SkillLine.db</code> is used to build the professions table. The profession table is
required to check the players professions against quest requirements. It's
basically a profession-id to profession-name translation table.</p>

</div><div class="footer">June 2021 - powered by <a href="https://github.com/shagu/webls">webls</a></div></div>
    </div>
  </div>
</body>

</html>
