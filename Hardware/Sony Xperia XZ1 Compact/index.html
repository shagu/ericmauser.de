<!doctype html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="description" content="just some random notes" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300&display=swap" rel="stylesheet" />
  <link href="../../style.css" rel="stylesheet" />
  <title>ericmauser - just some random notes</title>
</head>

<body>
  <div class="sidebar">
    <div class="viewport">
      <div class="topbar">
        <a class="title" href="../../">ericmauser</a>
        <span class="description">just some random notes</span>
      </div>
      <div class="navigation"><a href="../../">welcome!</a> » <a href="../">Hardware</a> » <span>Sony Xperia XZ1 Compact</span></div>
    </div>
  </div>

  <div class="viewport mainview">
    <div class="directories">
      <a class="back sidelink" href="../">« Back</a>
    </div>
    <div class="page">
      <div class="content"><div id="xperia-xz1-compact-aosp.md" class="text">
<p>(2020/02/02)</p>

<h1>Sony Xperia XZ1 Compact (lilac)</h1>
<h2>Android Open Source Project (AOSP)</h2>
<h3>Prepare LXC</h3>
<pre><code>lxc-create -n aosp -t download
sed -i "s/lxc.net.0.type = empty/lxc.net.0.type = none/g" /var/lib/lxc/aosp/config

mv /var/lib/lxc/aosp /home/eric/aosp
ln -s /home/eric/aosp /var/lib/lxc/aosp
lxc-start  -n aosp
lxc-attach -n aosp

echo 'echo "nameserver 8.8.8.8" &gt; /etc/resolv.conf' &gt;&gt; /root/.bashrc &amp;&amp; exit
lxc-attach -n aosp
</code></pre>

<h3>Install Dependencies</h3>
<pre><code>dpkg --add-architecture i386
apt-get update
apt-get install openjdk-8-jdk repo
apt-get install bison g++-multilib git gperf libxml2-utils make zlib1g-dev:i386 \
                zip liblz4-tool libncurses5 libssl-dev bc flex rsync
</code></pre>

<h3>Prepare Sources</h3>
<pre><code>su -l ubuntu
export branch=android-10.0.0_r21
git config --global user.email "build@ubuntu"
git config --global user.name "local"

mkdir ~/android
cd ~/android
repo init -u https://android.googlesource.com/platform/manifest -b $branch

cd .repo
git clone https://github.com/sonyxperiadev/local_manifests
cd local_manifests
git checkout $branch
cd ../..
repo sync
./repo_update.sh
</code></pre>

<h2>Rebuild Kernel (optional)</h2>
<p>Currently required, due to <a href="https://github.com/sonyxperiadev/bug_tracker/issues/530">[Yoshino][Lilac] Kernel 4.14 bootloops.</a>:</p>
<pre><code>cd kernel/sony/msm-4.14/kernel/
git checkout b5b8742^
cd -
</code></pre>

<h2>Build</h2>
<pre><code>source build/envsetup.sh &amp;&amp; lunch
make -j$(nproc)
</code></pre>

<h2>Flash</h2>
<pre><code>fastboot flash oem SW_binaries_for_Xperia_Android_10*.img

fastboot flash boot boot.img
fastboot flash recovery recovery.img
fastboot flash system system.img
fastboot flash vendor vendor.img
fastboot flash userdata userdata.img
</code></pre>

</div><div id="xperia-xz1-compact-lineage.md" class="text">
<h1>Sony Xperia XZ1 Compact (lilac)</h1>

<h2>Lineage OS</h2>
<h3>Prepare LXC</h3>

<pre><code>lxc-create -n lineage -t ubuntu

sed -i "s/lxc.net.0.type = empty/lxc.net.0.type = none/g" /var/lib/lxc/lineage/config

lxc-start  -n lineage
lxc-attach -n lineage

echo 'echo "nameserver 8.8.8.8" &gt; /etc/resolv.conf' &gt;&gt; /root/.bashrc &amp;&amp; exit
lxc-attach -n lineage

apt-get update &amp;&amp; apt-get upgrade
apt-get install bc bison bsdmainutils build-essential curl flex gcc-multilib \
    git g++-multilib gnupg gperf imagemagick lib32ncurses5-dev lib32readline6-dev \
    lib32z1-dev libesd0-dev liblz4-tool libncurses5-dev libsdl1.2-dev libssl-dev \
    libwxgtk3.0-dev libxml2 libxml2-utils lzop make openjdk-8-jdk pngcrush repo \
    rsync schedtool squashfs-tools xsltproc zip zlib1g-dev
</code></pre>

<h3>Setup Build Environment</h3>

<pre><code>su -l ubuntu

git config --global user.email "build@lineage"
git config --global user.name "Build User"

repo init -u git://github.com/LineageOS/android.git -b lineage-15.0
mkdir .repo/local_manifests
cat &gt; .repo/local_manifests/roomservice.xml &lt;&lt; EOF
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;manifest&gt;
  &lt;!-- SONY --&gt;
  &lt;project name="LineageOS/android_hardware_sony_macaddrsetup" path="hardware/sony/macaddrsetup" remote="github" /&gt;
  &lt;project name="LineageOS/android_hardware_sony_thermanager" path="hardware/sony/thermanager" remote="github" /&gt;
  &lt;project name="LineageOS/android_hardware_sony_timekeep" path="hardware/sony/timekeep" remote="github" /&gt;
  &lt;project name="LineageOS/android_device_qcom_common" path="device/qcom/common" remote="github" /&gt;
  &lt;project name="LineageOS/android_device_sony_common" path="device/sony/common" remote="github" /&gt;
  &lt;project name="cryptomilk/android_kernel_sony_msm8998" path="kernel/sony/msm8998" remote="github" /&gt;
  &lt;project name="cryptomilk/android_device_sony_common-treble" path="device/sony/common-treble" remote="github" /&gt;
  &lt;project name="cryptomilk/android_device_sony_yoshino" path="device/sony/yoshino" remote="github" /&gt;
  &lt;project name="cryptomilk/android_device_sony_lilac" path="device/sony/lilac" remote="github" /&gt;
  &lt;!--&lt;project name="cryptomilk/proprietary_vendor_sony_lilac" path="vendor/sony/lilac" remote="github" /&gt;--&gt;
&lt;/manifest&gt;
EOF

repo sync
</code></pre>

<h3>Build</h3>

<pre><code>source build/envsetup.sh
lunch lineage_lilac-userdebug
make -j8 bacon
</code></pre>

</div><div class="footer">June 2021 - powered by <a href="https://github.com/shagu/webls">webls</a></div></div>
    </div>
  </div>
</body>

</html>
